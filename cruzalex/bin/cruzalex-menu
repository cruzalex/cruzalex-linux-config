#!/usr/bin/env bash
# cruzAlex Main Menu
# Central control menu like Omarchy

set -euo pipefail

# Detect launcher
if command -v walker &> /dev/null; then
    LAUNCHER="walker --dmenu"
elif command -v wofi &> /dev/null; then
    LAUNCHER="wofi --dmenu --prompt 'cruzAlex' --width 400 --height 400"
elif command -v fuzzel &> /dev/null; then
    LAUNCHER="fuzzel --dmenu --prompt 'cruzAlex: '"
else
    notify-send "cruzAlex Menu" "No launcher found" -u critical
    exit 1
fi

# Menu categories
MAIN_MENU="ğŸ¨ Style
ğŸ–¥ï¸  System
ğŸ“¦ Packages
âš™ï¸  Settings
ğŸ”§ Tools
â“ Help"

show_style_menu() {
    local options="ğŸ¨ Pick Theme
ğŸ–¼ï¸  Next Wallpaper
ğŸ”„ Toggle Wallpaper Rotation
ğŸŒ™ Toggle Nightlight
ğŸ‘ï¸  Toggle Transparency"

    local selection
    selection=$(echo -e "$options" | $LAUNCHER 2>/dev/null) || return

    case "$selection" in
        "ğŸ¨ Pick Theme")
            ghostty -e cruzalex-themes &
            ;;
        "ğŸ–¼ï¸  Next Wallpaper")
            cruzalex-wallpaper-next
            ;;
        "ğŸ”„ Toggle Wallpaper Rotation")
            cruzalex-wallpaper-rotate toggle
            ;;
        "ğŸŒ™ Toggle Nightlight")
            pkill hyprsunset || hyprsunset -t 4500 &
            ;;
        "ğŸ‘ï¸  Toggle Transparency")
            hyprctl setprop active opaque toggle
            ;;
    esac
}

show_system_menu() {
    local options="ğŸ“Š Activity Monitor
ğŸ”Š Audio Settings
ğŸ“¶ WiFi Settings
ğŸ“± Bluetooth Settings
ğŸ”’ Lock Screen
ğŸ’¤ Suspend
ğŸ”„ Reload Hyprland
ğŸ”ƒ Reboot
â» Shutdown"

    local selection
    selection=$(echo -e "$options" | $LAUNCHER 2>/dev/null) || return

    case "$selection" in
        "ğŸ“Š Activity Monitor")
            ghostty -e btop &
            ;;
        "ğŸ”Š Audio Settings")
            pavucontrol &
            ;;
        "ğŸ“¶ WiFi Settings")
            ghostty -e impala &
            ;;
        "ğŸ“± Bluetooth Settings")
            ghostty -e bluetui &
            ;;
        "ğŸ”’ Lock Screen")
            hyprlock
            ;;
        "ğŸ’¤ Suspend")
            systemctl suspend
            ;;
        "ğŸ”„ Reload Hyprland")
            hyprctl reload
            ;;
        "ğŸ”ƒ Reboot")
            systemctl reboot
            ;;
        "â» Shutdown")
            systemctl poweroff
            ;;
    esac
}

show_packages_menu() {
    local options="ğŸ“¦ Update System
â• Install Package
â– Remove Package"

    local selection
    selection=$(echo -e "$options" | $LAUNCHER 2>/dev/null) || return

    case "$selection" in
        "ğŸ“¦ Update System")
            if command -v dnf &> /dev/null; then
                ghostty -e sudo dnf upgrade &
            else
                ghostty -e sudo pacman -Syu &
            fi
            ;;
        "â• Install Package")
            ghostty -e bash -c 'read -p "Package name: " pkg && sudo dnf install "$pkg" || sudo pacman -S "$pkg"' &
            ;;
        "â– Remove Package")
            ghostty -e bash -c 'read -p "Package name: " pkg && sudo dnf remove "$pkg" || sudo pacman -Rs "$pkg"' &
            ;;
    esac
}

show_settings_menu() {
    local options="âŒ¨ï¸  Edit Keybindings
ğŸ–¥ï¸  Edit Hyprland Config
ğŸ“ Edit Dotfiles
ğŸš Edit Shell Config"

    local selection
    selection=$(echo -e "$options" | $LAUNCHER 2>/dev/null) || return

    case "$selection" in
        "âŒ¨ï¸  Edit Keybindings")
            ghostty -e nvim ~/.config/hypr/bindings.conf &
            ;;
        "ğŸ–¥ï¸  Edit Hyprland Config")
            ghostty -e nvim ~/.config/hypr/hyprland.conf &
            ;;
        "ğŸ“ Edit Dotfiles")
            ghostty -e yazi ~/.config &
            ;;
        "ğŸš Edit Shell Config")
            ghostty -e nvim ~/.zshrc &
            ;;
    esac
}

show_tools_menu() {
    local options="ğŸ“ Neovim
ğŸ—‚ï¸  Yazi (Files)
ğŸ™ Lazygit
ğŸ³ Lazydocker
ğŸµ Spotify Player"

    local selection
    selection=$(echo -e "$options" | $LAUNCHER 2>/dev/null) || return

    case "$selection" in
        "ğŸ“ Neovim")
            ghostty -e nvim &
            ;;
        "ğŸ—‚ï¸  Yazi (Files)")
            ghostty -e yazi &
            ;;
        "ğŸ™ Lazygit")
            ghostty -e lazygit &
            ;;
        "ğŸ³ Lazydocker")
            ghostty -e lazydocker &
            ;;
        "ğŸµ Spotify Player")
            ghostty -e spotify_player &
            ;;
    esac
}

show_help_menu() {
    local options="âŒ¨ï¸  Show Keybindings
ğŸ“š Open Documentation
ğŸ› Report Issue
â„¹ï¸  About cruzAlex"

    local selection
    selection=$(echo -e "$options" | $LAUNCHER 2>/dev/null) || return

    case "$selection" in
        "âŒ¨ï¸  Show Keybindings")
            ghostty -e cruzalex-keybindings &
            ;;
        "ğŸ“š Open Documentation")
            chromium https://github.com/cruzalex/cruzalex-linux-config &
            ;;
        "ğŸ› Report Issue")
            chromium https://github.com/cruzalex/cruzalex-linux-config/issues &
            ;;
        "â„¹ï¸  About cruzAlex")
            local version
            version=$(cat ~/.config/cruzalex/version 2>/dev/null || echo "0.1.0")
            notify-send "cruzAlex Linux" "Version: $version\n\nA TUI-first Linux experience inspired by Omarchy" -u normal
            ;;
    esac
}

# Main menu
SELECTION=$(echo -e "$MAIN_MENU" | $LAUNCHER 2>/dev/null) || exit 0

case "$SELECTION" in
    "ğŸ¨ Style")
        show_style_menu
        ;;
    "ğŸ–¥ï¸  System")
        show_system_menu
        ;;
    "ğŸ“¦ Packages")
        show_packages_menu
        ;;
    "âš™ï¸  Settings")
        show_settings_menu
        ;;
    "ğŸ”§ Tools")
        show_tools_menu
        ;;
    "â“ Help")
        show_help_menu
        ;;
esac
